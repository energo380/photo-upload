<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 520px;
      width: 100%;
    }

    .company-name {
      color: #dc143c;
      font-size: 20px;
      font-weight: bold;
      line-height: 1.4;
      margin-bottom: 15px;
      text-align: center;
    }

    h1 {
      color: #333;
      margin-bottom: 16px;
      text-align: center;
      font-size: 28px;
    }

    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      background: #f8f9ff;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-area:hover {
      background: #e8ebff;
      border-color: #764ba2;
    }

    .upload-icon { font-size: 60px; margin-bottom: 20px; }
    .upload-text { color: #666; font-size: 18px; margin-bottom: 10px; }
    .upload-hint { color: #999; font-size: 14px; }

    input[type="file"] { display: none; }

    .preview { margin-top: 22px; text-align: center; }
    .preview img {
      max-width: 100%;
      max-height: 380px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .button-group {
      margin-top: 22px;
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn {
      padding: 14px 26px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: bold;
    }

    .btn-send { background: #4CAF50; color: white; }
    .btn-send:hover { background: #45a049; transform: translateY(-1px); }
    .btn-send:disabled { background: #cccccc; cursor: not-allowed; transform: none; }

    .btn-cancel { background: #f44336; color: white; }
    .btn-cancel:hover { background: #da190b; transform: translateY(-1px); }

    #status {
      margin-top: 18px;
      padding: 14px;
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
      display: none;
      word-break: break-word;
    }

    .status-success { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
    .status-error   { background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
    .status-loading { background: #d1ecf1; color: #0c5460; border: 2px solid #bee5eb; }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 34px;
      height: 34px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
  </style>
</head>

<body>
  <div class="container">
    <div class="company-name">
      –†–µ–º–æ–Ω—Ç —ç–ª–µ–∫—Ç—Ä–æ–¥–≤–∏–≥–∞—Ç–µ–ª–µ–π<br>
      –ê–û "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –ø—Ç–∏—Ü–µ—Ñ–∞–±—Ä–∏–∫–∞"
    </div>

    <h1>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</h1>

    <form id="photoForm">
      <label for="photo" class="upload-area" id="uploadArea">
        <div class="upload-icon">üì∑</div>
        <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ</div>
        <div class="upload-hint">–∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–æ–∫ –∫–∞–º–µ—Ä–æ–π</div>
      </label>

      <input type="file" id="photo" name="photo" accept="image/*" capture="environment" required>

      <div class="preview" id="preview"></div>

      <div class="button-group" id="buttonGroup" style="display:none;">
        <button type="submit" class="btn btn-send" id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        <button type="button" class="btn btn-cancel" id="cancelBtn">–û—Ç–º–µ–Ω–∏—Ç—å</button>
      </div>
    </form>

    <div id="status"></div>
  </div>

  <script>
    const WORKER_URL = "https://tg-photo-proxy.jazogm.workers.dev";
    const MAX_MB = 20; // –ª–∏–º–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, —á—Ç–æ–±—ã –Ω–µ —Å–ª–∞—Ç—å —Å–æ–≤—Å–µ–º –æ–≥—Ä–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã

    const photoInput = document.getElementById("photo");
    const preview = document.getElementById("preview");
    const buttonGroup = document.getElementById("buttonGroup");
    const form = document.getElementById("photoForm");
    const status = document.getElementById("status");
    const cancelBtn = document.getElementById("cancelBtn");
    const sendBtn = document.getElementById("sendBtn");

    let selectedFile = null;

    function showStatus(message, type) {
      status.innerHTML = message;
      status.className = `status-${type}`;
      status.style.display = "block";
    }

    function resetAll() {
      form.reset();
      preview.innerHTML = "";
      buttonGroup.style.display = "none";
      status.style.display = "none";
      selectedFile = null;
      sendBtn.disabled = false;
    }

    cancelBtn.addEventListener("click", resetAll);

    photoInput.addEventListener("change", () => {
      const file = photoInput.files && photoInput.files[0];
      if (!file) return;

      if (file.size > MAX_MB * 1024 * 1024) {
        showStatus(`‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º ${MAX_MB} –ú–ë`, "error");
        return;
      }

      selectedFile = file;

      const url = URL.createObjectURL(file);
      preview.innerHTML = `<img src="${url}" alt="preview">`;
      buttonGroup.style.display = "flex";
      showStatus("–§–æ—Ç–æ –≤—ã–±—Ä–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ¬ª.", "success");
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!selectedFile) {
        showStatus("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ.", "error");
        return;
      }

      sendBtn.disabled = true;
      buttonGroup.style.display = "none";
      showStatus('<div class="spinner"></div><div style="margin-top:10px;">–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...</div>', "loading");

      try {
        const fd = new FormData();
        fd.append("photo", selectedFile, selectedFile.name || "photo.jpg");
        fd.append("caption", `–§–æ—Ç–æ —Å —Å–∞–π—Ç–∞. –§–∞–π–ª: ${selectedFile.name || "photo.jpg"}`);

        const res = await fetch(WORKER_URL, { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          throw new Error(data.error || "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (Worker/Telegram)");
        }

        showStatus("‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!", "success");
        setTimeout(resetAll, 2000);
      } catch (err) {
        console.error(err);
        showStatus("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.", "error");
        buttonGroup.style.display = "flex";
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>

